cmake_minimum_required(VERSION 2.6)
project(switchserialmode)
include_directories(.)
aux_source_directory(serial serial_source_list)
aux_source_directory(transceiver transceiver_source_list)
add_executable(switchserialmode switchserialmode.c gpio_helper.c ${serial_source_list} ${transceiver_source_list})
set(CMAKE_INSTALL_PREFIX "/usr")
find_package(PkgConfig REQUIRED)
pkg_check_modules(GPIOD REQUIRED libgpiod)
message(STATUS "GPIOD: ${GPIOD_FOUND}")
if(GPIOD_FOUND)
    message(STATUS "GPIOD Version: ${GPIOD_VERSION}")
    if (GPIOD_VERSION VERSION_GREATER_EQUAL "2.0.")
        add_definitions(-DLIB_GPIOD_V2_API)
    else()
        add_definitions(-DLIB_GPIOD_V1_API)
    endif()
    message(STATUS "Using libgpiod V${GPIOD_VERSION} API")
else()
    message(FATAL_ERROR "Cannot find libgpiod")
endif()
target_link_libraries(switchserialmode usb-1.0 gpiod)
install(TARGETS switchserialmode RUNTIME DESTINATION bin)
